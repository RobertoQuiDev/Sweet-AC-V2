
Robertolink = "aucun" 
errortentative = 1

function inTable(H,I)
    for J,K in pairs(H)do 
        if K==I then 
            return J 
        end 
    end
    return false 
end

Aulthinfo = {}

-- function djkasbdyavdiabvod()
--     function encss(data)
--         local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
--         return ((data:gsub('.', function(x) 
--             local r,b='',x:byte()
--             for i=8,1,-1 do r=r..(b%2^i-b%2^(i-1)>0 and '1' or '0') end
--             return r;
--         end)..'0000'):gsub('%d%d%d?%d?%d?%d?', function(x)
--             if (#x < 6) then return '' end
--             local c=0
--             for i=1,6 do c=c+(x:sub(i,i)=='1' and 2^(6-i) or 0) end
--             return b:sub(c+1,c+1)
--         end)..({ '', '==', '=' })[#data%3+1])
--     end
    
--     aniamatedegir = true
--     local keyaulth = encss(SwatCS.ServerKey)
--     PerformHttpRequest(
--         "http://127.0.0.1/aulth.php/aulth.php?key=" .. keyaulth,
--         function(errorCode, resultDataIP, resultHeaders)
--             Wait(10000)
--             local ay = json.decode(resultDataIP)
--             if SwatCS.debug then
--                 print(resultDataIP)
--             end
--             if resultDataIP ~= nil or ay == nil then
--                 if ay['aulth'] == 'Roberto#8622' then
--                     Aulthinfo.Daym = ay['daym']
--                     Aulthinfo.ip = ay['ip']
--                     Aulthinfo.eday = ay['eday']
--                     Aulthinfo.eheur = ay['eheur']
--                     Aulthinfo.emin = ay['emin']
--                     Aulthinfo.esec = ay['esec']
--                     Aulthinfo.acv = ay['acversion']
--                     Aulthinfo.satus = ay['status']
--                     Aulthinfo.alpha = ay['isalpha']
--                     if Aulthinfo.eday > -1 then
--                         djsakduiahe789uhqrfyui = true
--                         Wait(2000)
--                         sadsadsadfv()
--                     else
--                         print('fini')
--                         print("\n^3SweetAC ^0| License valid for : ".. Aulthinfo.eday .." Days, " .. Aulthinfo.eheur .. " Hours, "..Aulthinfo.emin .." Minutes, ".. Aulthinfo.esec .." Seconds")
--                     end
--                 else
--                     Wait(150)
--                     if SwatCS.ServerName ~= nil then
--                         PerformHttpRequest("", function(err, text, headers) end, 'POST', json.encode({username = "FDP QUI ESSAIS DE LEAK", content = "```\netat : " .. resultDataIP .. "\nAction : A essaiyer de leak ton AC XD " .. "\n\nDEBUG :  \nVersion : Special slurry 1   \nBuild Date : 10/22/2021 \nSweetCounter : 1" .."```" }), { ['Content-Type'] = 'application/json' })
--                     else
--                         PerformHttpRequest("", function(err, text, headers) end, 'POST', json.encode({username = "FDP QUI ESSAIS DE LEAK", content = "```\netat : " .. resultDataIP .. "\nAction : A essaiyer de leak ton AC XD " .. "\n\nDEBUG :  \nVersion : Special  slurry 1 \nBuild Date : 10/22/2021 \nSweetCounter : 1" .."```" }), { ['Content-Type'] = 'application/json' })
--                     end
--                     print("^3[Sweet] ^7 ^4ERROR!")
--                     print("^3[Sweet] ^7 ^1Mauvaise Key ^7: ^1Ta crue que Roberto Ã©tait con ?^7!")
--                     print("^3[Sweet] ^7 ^1Stop de ac")
--                     Wait(1500)
--                     os.exit()
--                     StopResource(GetCurrentResourceName())
--                     return
--                 end
--             else
--                 if errortentative ~= 4 then 
--                     print('^4[ Sweet-AC ]^1 Problem avec les serveur de authentification')
--                     djkasbdyavdiabvod()
--                     print('Recheck en cours Essais : ['.. errortentative..']')
--                     errortentative = errortentative + 1
--                 else
--                     print('^4[ Sweet-AC ] ^1STOP AC ^4DM Sweet staff')
--                     Wait(100)
--                     StopResource(GetCurrentResourceName())
--                     os.exit()
--                     return
--                 end
--             end         
--         end
--     )
-- end
                    Aulthinfo.Daym = 'lifetime'
                    Aulthinfo.ip = '127.0.0.1'
                    Aulthinfo.eday = 'lifetime'
                    Aulthinfo.eheur = 'lifetime'
                    Aulthinfo.emin = 'lifetime'
                    Aulthinfo.esec = 'lifetime'
                    Aulthinfo.acv = versionac
                    Aulthinfo.satus = 'github'
                    Aulthinfo.alpha = 'false'
                    aniamatedegir = true
                    djsakduiahe789uhqrfyui = true
                        sadsadsadfv()

--
-- Citizen.CreateThread(function()
--     djkasbdyavdiabvod()
-- end)
function sadsadsadfv()
    if djsakduiahe789uhqrfyui then
        djsakduiahe789uhqrfyui = false

    
            
        --
        --- LOCAL / VAR
        --
        local BanList            = {}
        local BanListLoad        = false
        local vehspawncount = {}
        local pedsspawncount = {}
        local particlesspawncount = {}
        local firespawncount = {}
        local msec = math.random(5000,6000)
        local EntityOwner = NetworkGetEntityOwner(entity)
        local modelentity = GetEntityModel(entity)
        local phonetable = SwatCS.sql.phone_messages_Table
        local policesql = SwatCS.sql.police
        local ambulancesql = SwatCS.sql.ambulance
        local bcsosql = SwatCS.sql.bcso
        local mecanosql = SwatCS.sql.mecano
        local versionac = "1.67 dc 45 d4 69 Special " .. SwatCS.ServerName ..""
        local DatabaseStuff = {}
        local screenshotOptions = {
            encoding = 'png',
            quality = 1
        } 
        local heur = os.date('%H:%M:%S', os.time())
        local detect = {}
        local killcount = {}
        local banrate = {}

        TriggerEvent(SwatCC.ESXoption.ESXTrigger, function(obj) spyke = obj end)


        CreateThread(function()
            while true do
                Wait(10000)

                if BanListLoad == false then
                    loadBanList()

                    if BanList ~= {} then
                        --print(Text.banlistloaded)
                        BanListLoad = true
                    else
                        --print(Text.starterror)
                    end
                end
            end
        end)

        function CountDetect()
            detect = {}
            banrate = {}
            SetTimeout(30000, CountDetect)
        end
        function Countkill()
            killcount = {}
            SetTimeout(5000, Countkill)
        end

        function iosahbfastdc()
            vehspawncount = {}
            pedsspawncount = {}
            particlesspawncount = {}
            firespawncount = {}
            SetTimeout(10000, iosahbfastdc)
        end

        CreateThread(function()
            while true do
                Wait(600000)
                if BanListLoad == true then
                    loadBanList() -- banlist se recharge tout les 10 minutes ^^
                end
            end
        end)

        RegisterServerEvent('Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag')
        AddEventHandler('Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag', function(reason,servertarget)
            if servertarget == -1 then
                print('ton trigger de banAC a leak')
                PerformHttpRequest("", function(err, text, headers) end, 'POST', json.encode({username = "Trigger ban leak", content = "```\nAction : Triggerban a ete leak en -1 @everyone " .. "\n\nDEBUG :  \nVersion : Special " .. SwatCS.ServerName .. " \nBuild Date : 7/28/2021 \nSweetCounter : 1" .."```" }), { ['Content-Type'] = 'application/json' })
                CancelEvent()
            else

                local license,identifier,liveid,xblid,discord,playerip,target
                local duree     = 0
                local reason    = reason
                if not reason then reason = "Sweet-AC" end

                if tostring(source) == "" then
                    target = tonumber(servertarget)
                else
                    target = source
                end

                if target and target > 0 then
                    local ping = GetPlayerPing(target)

                    if ping and ping > 0 then
                        if duree and duree < 365 then
                            local sourceplayername = SwatCC.Prefix
                            local targetplayername = GetPlayerName(target)

                            for k,v in ipairs(GetPlayerIdentifiers(target))do
                                if string.sub(v, 1, string.len("license:")) == "license:" then
                                    license = v
                                    ST = v
                                elseif string.sub(v, 1, string.len("steam:")) == "steam:" then
                                    identifier = v
                                elseif string.sub(v, 1, string.len("live:")) == "live:" then
                                    liveid = v
                                elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
                                    xblid  = v
                                elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
                                    discord = v
                                elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
                                    playerip = v
                                end
                            end

                            hwid = GetPlayerToken(servertarget)
                            if hwid == nil then 
                                hwid = 'Pas trouver'
                            end

                            if SwatCS.Debug ~= true then
                                TriggerClientEvent(SwatCC.TrigPrefix ..'spyke_outlawalert:sync',servertarget)
                                Wait(2000)
                                if duree > 0 then
                                    ban(target,license,identifier,liveid,xblid,discord,playerip,hwid,targetplayername,sourceplayername,duree,reason,0) --Timed ban here
                                    DropPlayer(target, "Vous avez Ã©tÃ© banni du serveur par ".. SwatCC.Prefix .. " de Roberto#8622 | Code de ban AC: " .. reason.. ", discord : " .. SwatCS.discord)
                                else
                                    ban(target,license,identifier,liveid,xblid,discord,playerip,hwid,targetplayername,sourceplayername,duree,reason,1) --Timed ban here
                                    DropPlayer(target, "Vous avez Ã©tÃ© banni du serveur par ".. SwatCC.Prefix .. " de Roberto#8622 | Code de ban AC: " .. reason.. ", discord : " .. SwatCS.discord)
                                end
                            else
                                print('tes ban')
                            end
                        else
                            --print("BanSql Error : Auto-Cheat-Ban time invalid.")
                        end
                    else
                        --print("BanSql Error : Auto-Cheat-Ban target are not online.")
                    end
                else
                    --print("BanSql Error : Auto-Cheat-Ban have recive invalid id.")
                end
            end
        end)

        RegisterServerEvent('Roberto:swtchatlogC')
        AddEventHandler('Roberto:swtchatlogC', function(reason, letter)
            TriggerEvent('Roberto:swtchatlogS', reason , source, letter)
        end)
        --Exec function count
        iosahbfastdc()
        CountDetect()
        Countkill()
        --
        AddEventHandler('detectlimit', function(ids, res)
            if detect[ids] ~= nil then
                if detect[ids] ~= 'off' then
                    if detect[ids] == 9 then 
                        if res == 'stop' then 
                            TriggerEvent('Roberto:swtchatlogS', 'stop Desudo / Redengine' , ids, 'B')
                            Wait(100)
                            TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "stop RedEngine / Desudo ):" ,ids)
                        else
                            TriggerEvent('Roberto:swtchatlogS', 'ses trop fait detect dans la session' , ids, 'K')
                            Wait(100)
                            DropPlayer(ids, 'Vous demandez trop de requÃªtes a anticheat. Merci d\'Ã©viter le Cheat, peut importe le type de ExÃ©cuteur ! Vous pouvez vous reconnecter.')
                        end
                        print('TO much detect '.. ids)      
                        detect[ids] = 'off'
                    else
                        detect[ids] = detect[ids] + 1
                        -- print(detect[ids])
                    end
                end
            else
                detect[ids] = 1
            end
        end)

        AddEventHandler('entityCreating', function(entity)
            if SwatCS.BlacklistedEntityDetection then
                for _,blacklistedentity in ipairs(SwatCS.BlacklistedEntities) do
                    if modelentity == GetHashKey(blacklistedentity) then
                        CancelEvent()
                        TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de spawn une blacklisted entity: **'..blacklistedentity..'**' , EntityOwner, 'D')
                        break
                    end
                end
            end
        end)


        --load("\32\32\32\32\32\32\32\32\105\102\32\97\110\105\97\109\97\116\101\100\101\103\105\114\32\126\61\32\116\114\117\101\32\116\104\101\110\10\32\32\32\32\32\32\32\32\32\32\32\32\111\115\46\101\120\105\116\40\41\10\32\32\32\32\32\32\32\32\32\32\32\32\112\114\105\110\116\40\39\115\114\120\32\108\97\32\105\108\32\102\97\117\116\32\101\116\114\101\32\99\111\110\40\58\39\41\10\32\32\32\32\32\32\32\32\101\110\100\10")()

        if SwatCS.BaseCalifornia.on then 
            if SwatCS.BaseCalifornia.killall then
                RegisterServerEvent(SwatCC.TrigPrefix ..'cmg2_animations:sync')
                AddEventHandler(SwatCC.TrigPrefix ..'cmg2_animations:sync', function(animationLib, animation, animation2, distans, distans2, height, targetSrc, length, spin, controlFlagSrc, controlFlagTarget, animFlagTarget)
                    if targetSrc == -1 then 
                        TriggerEvent('Roberto:swtchatlogS', '**a essaiyer de kill all avec -1 (type 1)**' , source, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "kill all" ,source)
                        CancelEvent()
                        return
                    end
                end)

                RegisterServerEvent(SwatCC.TrigPrefix ..'cmg2_animations:stop')
                AddEventHandler(SwatCC.TrigPrefix ..'cmg2_animations:stop', function(targetSrc)
                    if targetSrc == -1 then 
                        TriggerEvent('Roberto:swtchatlogS', '**a essaiyer de kill all avec -1 (type 2)**' , source, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "kill all" ,source)
                        CancelEvent()
                        return
                    end
                end)

                RegisterServerEvent(SwatCC.TrigPrefix ..'cmg3_animations:sync')
                AddEventHandler(SwatCC.TrigPrefix ..'cmg3_animations:sync', function(animationLib, animationLib2, animation, animation2, distans, distans2, height, targetSrc, length, spin, controlFlagSrc, controlFlagTarget, animFlagTarget, attachFlag)
                    if targetSrc == -1 then 
                        TriggerEvent('Roberto:swtchatlogS', '**a essaiyer de kill all avec -1 (type 3)**' , source, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "kill all" ,source)
                        CancelEvent()
                        return
                    end
                end)

                RegisterServerEvent(SwatCC.TrigPrefix ..'cmg3_animations:stop')
                AddEventHandler(SwatCC.TrigPrefix ..'cmg3_animations:stop', function(targetSrc)
                    if targetSrc == -1 then
                        TriggerEvent('Roberto:swtchatlogS', '**a essaiyer de kill all avec -1 (type 4)**' , source, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "kill all" ,source)
                        CancelEvent()
                        return
                    end
                end)

            end
        end


        if SwatCS.anticlearpedtask then
            AddEventHandler("clearPedTasksEvent", function(source, data)
                if data.immediately then
                    TriggerEvent('Roberto:swtchatlogS', '**clearPedTasks**' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "681" ,source)
                end
            end)
        end

        if SwatCS.blacklistName.on then
            AddEventHandler("playerConnecting", function(playerName, setKickReason)
                for name in pairs(SwatCS.blacklistNameList) do
                    if(string.gsub(string.gsub(string.gsub(string.gsub(playerName:lower(), "-", ""), ",", ""), "%.", ""), " ", ""):find(SwatCS.blacklistNameList[name])) then
                        print('[' .. SwatCC.Prefix ..'] '.. playerName .. " ses co avec un nom blacklist")
                        setKickReason('[' .. SwatCC.Prefix ..'] ' .. SwatCS.blacklistName.refusemessage)
                        CancelEvent()
                        break
                    end
                end
            end)
        end




        RegisterServerEvent('Roberto:swtchatlogS')
        AddEventHandler('Roberto:swtchatlogS', function(reason, servertarget, letter)
            if SwatCS.Chatdetect then
                if GetPlayerName(servertarget) ~= nil then
                    if letter == 'D' then
                        if reason ~= 'rien' then
                            TriggerEvent('detectlimit',servertarget,'Detect')
                            LogBanToDiscord(servertarget, reason,'Detect')
                        end
                        local xPlayers = spyke.GetPlayers()
                        for i = 1, #xPlayers, 1 do
                            local xPlayer = spyke.GetPlayerFromId(xPlayers[i])
                            if xPlayer and xPlayer.getGroup() ~= "user" then
                                Citizen.Wait(0)
                                TriggerClientEvent('chatMessage', xPlayer.source, "^4[".. SwatCC.Prefix .. "ðŸŒŠ]", {
                                    math.random(1, 255),
                                    math.random(1, 255),
                                    math.random(1, 255)
                                }, "^8Detect! ðŸŒŠ^6 ["..servertarget.."] ^6".. GetPlayerName(servertarget) .."^9 got detected")
                                Citizen.Wait(0)
                            end
                        end
                    elseif letter == 'K' then
                        if reason ~= 'rien' then
                            LogBanToDiscord(servertarget,reason,'KICK')
                        end
                        local xPlayers = spyke.GetPlayers()
                        for i = 1, #xPlayers, 1 do
                            local xPlayer = spyke.GetPlayerFromId(xPlayers[i])
                            if xPlayer and xPlayer.getGroup() ~= "user" then
                                Citizen.Wait(0)
                                TriggerClientEvent('chatMessage', xPlayer.source, "^4[".. SwatCC.Prefix .. "ðŸŒŠ]Ë‡", {
                                    math.random(1, 255),
                                    math.random(1, 255),
                                    math.random(1, 255)
                                }, "^8Kicked! ðŸŒŠ^6 ["..servertarget.."] ^6".. GetPlayerName(servertarget) .."^9 got detected")
                            end
                        end
                        local lol = math.random(5000,6000)
                        DropPlayer(servertarget, "Server->client connection timed out. Last seen "..lol.." msec ago.")
                    elseif letter == 'B' then
                        if banrate[servertarget] ~= 'ban' then 
                            banrate[servertarget] = 'ban'

                            if reason ~= 'rien' then
                                LogBanToDiscord(servertarget,reason,'BAN')
                            end
                            local xPlayers = spyke.GetPlayers()
                            for i = 1, #xPlayers, 1 do
                                local xPlayer = spyke.GetPlayerFromId(xPlayers[i])
                                if xPlayer and xPlayer.getGroup() ~= "user" then
                                    Citizen.Wait(0)
                                    TriggerClientEvent('chatMessage', xPlayer.source, "^4[".. SwatCC.Prefix .. "ðŸŒŠ] ", {
                                        math.random(1, 255),
                                        math.random(1, 255),
                                        math.random(1, 255)
                                    }, "^8Banned! ðŸŒŠ^6 ["..servertarget.."] ^6".. GetPlayerName(servertarget) .."^9 got detected")
                                    Citizen.Wait(0)
                                end
                            end
                        end
                    elseif letter == 'spawn' then
                        if reason ~= 'rien' then
                            LogSpawnVehcule(servertarget,reason,'delete vehcule')
                        end
                        local xPlayers = spyke.GetPlayers()
                        for i = 1, #xPlayers, 1 do
                            local xPlayer = spyke.GetPlayerFromId(xPlayers[i])
                            if xPlayer and xPlayer.getGroup() ~= "user" then
                                Citizen.Wait(0)
                                TriggerClientEvent('chatMessage', xPlayer.source, "^4[".. SwatCC.Prefix .. "ðŸŒŠ] ", {
                                    math.random(1, 255),
                                    math.random(1, 255),
                                    math.random(1, 255)
                                }, "^8Vehcule Spawn! ðŸŒŠ^6 ["..servertarget.."] ^6".. GetPlayerName(servertarget) .."^9 got detected")
                                Citizen.Wait(0)
                            end
                        end
                    end
                end
            end
        end)

        AddEventHandler('playerConnecting', function(playerName,setKickReason)
            local license,steamID,liveid,xblid,discord,playerip  = "n/a","n/a","n/a","n/a","n/a","n/a"

            for k,v in ipairs(GetPlayerIdentifiers(source))do
                if string.sub(v, 1, string.len("license:")) == "license:" then
                    license = v
                elseif string.sub(v, 1, string.len("steam:")) == "steam:" then
                    steamID = v
                elseif string.sub(v, 1, string.len("live:")) == "live:" then
                    liveid = v
                elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
                    xblid  = v
                elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
                    discord = v
                elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
                    playerip = v
                end
            end

            if GetNumPlayerTokens(source) == 0 or GetNumPlayerTokens(source) == nil or GetNumPlayerTokens(source) < 0 or GetNumPlayerTokens(source) == "null" or GetNumPlayerTokens(source) == "**Invalid**" or not GetNumPlayerTokens(source) then
                setKickReason(source, "".. SwatCC.Prefix .. " : Eureur relance fivem")
                CancelEvent()
                return
            end

            hwid = GetPlayerToken(source)

            --Si Banlist pas chargÃ©e
            if (Banlist == {}) then
                Citizen.Wait(1000)
            end

            for i = 1, #BanList, 1 do
                if
                    ((tostring(BanList[i].license)) == tostring(license)
                    or (tostring(BanList[i].identifier)) == tostring(steamID)
                    or (tostring(BanList[i].liveid)) == tostring(liveid)
                    or (tostring(BanList[i].xblid)) == tostring(xblid)
                    or (tostring(BanList[i].discord)) == tostring(discord)
                    or (tostring(BanList[i].playerip)) == tostring(playerip)
                    or (tostring(BanList[i].hwid)) == tostring(hwid))
                then
                    if (tonumber(BanList[i].permanent)) == 1 then
                        setKickReason("Vous avez Ã©tÃ© banni du serveur par ".. SwatCC.Prefix .. " de Roberto#8622 | Code de ban AC: " .. BanList[i].reason.. ", discord : " .. SwatCS.discord)
                        print("[".. SwatCC.Prefix .."]  ^7-8  ".. playerName .." [".. source .."] se connect au serveur mais est ban^0")
                        CancelEvent()
                        break
                    end
                end
            end
        end)

        function ban(source,license,identifier,liveid,xblid,discord,playerip,hwid,targetplayername,sourceplayername,duree,reason,permanent)
        --calcul total expiration (en secondes)
            local expiration = duree * 86400
            local timeat     = os.time()
            local added      = os.date()

            if expiration < os.time() then
                expiration = os.time()+expiration
            end


            table.insert(BanList, {
                license    = license,
                identifier = identifier,
                liveid     = liveid,
                xblid      = xblid,
                discord    = discord,
                playerip   = playerip,
                hwid       = hwid,
                reason     = reason,
                expiration = expiration,
                permanent  = permanent
            })
            if SwatCS.BanIP then 
                MySQL.Async.execute('INSERT INTO '.. SwatCS.sql.sweetban ..' (license,identifier,liveid,xblid,discord,playerip,hwid,targetplayername,sourceplayername,reason,expiration,timeat,permanent) VALUES (@license,@identifier,@liveid,@xblid,@discord,@playerip,@hwid,@targetplayername,@sourceplayername,@reason,@expiration,@timeat,@permanent)', {
                    ['@license']          = license,
                    ['@identifier']       = identifier,
                    ['@liveid']           = liveid,
                    ['@xblid']            = xblid,  
                    ['@discord']          = discord,
                    ['@playerip']         = playerip,
                    ['@hwid']             = hwid,
                    ['@targetplayername'] = targetplayername,
                    ['@sourceplayername'] = sourceplayername,
                    ['@reason']           = reason,
                    ['@expiration']       = expiration,
                    ['@timeat']           = timeat,
                    ['@permanent']        = permanent,
                }, function()
                end)
            else
                MySQL.Async.execute('INSERT INTO '.. SwatCS.sql.sweetban ..' (license,identifier,liveid,xblid,discord,playerip,hwid,targetplayername,sourceplayername,reason,expiration,timeat,permanent) VALUES (@license,@identifier,@liveid,@xblid,@discord,@playerip,@hwid,@targetplayername,@sourceplayername,@reason,@expiration,@timeat,@permanent)', {
                    ['@license']          = license,
                    ['@identifier']       = identifier,
                    ['@liveid']           = liveid,
                    ['@xblid']            = xblid,
                    ['@discord']          = discord,
                    ['@hwid']             = hwid,
                    ['@targetplayername'] = targetplayername,
                    ['@sourceplayername'] = sourceplayername,
                    ['@reason']           = reason,
                    ['@expiration']       = expiration,
                    ['@timeat']           = timeat,
                    ['@permanent']        = permanent,
                }, function()
                end)
            end
        end

        function loadBanList()
            MySQL.Async.fetchAll('SELECT * FROM '.. SwatCS.sql.sweetban, {}, function(data)
                BanList = {}

                for i=1, #data, 1 do
                    if SwatCS.BanIP then 
                        table.insert(BanList, {
                            license    = data[i].license,
                            identifier = data[i].identifier,
                            liveid     = data[i].liveid,
                            xblid      = data[i].xblid,
                            discord    = data[i].discord,
                            playerip   = data[i].playerip,
                            hwid       = data[i].hwid,
                            reason     = data[i].reason,
                            expiration = data[i].expiration,
                            permanent  = data[i].permanent
                        })
                    else
                        table.insert(BanList, {
                            license    = data[i].license,
                            identifier = data[i].identifier,
                            liveid     = data[i].liveid,
                            xblid      = data[i].xblid,
                            discord    = data[i].discord,
                            hwid       = data[i].hwid,
                            reason     = data[i].reason,
                            expiration = data[i].expiration,
                            permanent  = data[i].permanent
                        })
                    end
                end
            end)
        end

        AddEventHandler("playerConnecting", function(playerName, setKickReason)
            if playerName ~= nil then
                local color = "^"..math.random(0,9)
                print("[".. SwatCC.Prefix .."]  ^7- "..color.." ".. playerName .." [".. source .."] se connect au serveur^0")
            end
        end)

        LogBanToDiscord = function (playerId,reason,testuban)

            local playerId = tonumber(playerId)
            local nameplayer = GetPlayerName(playerId)
            local steamid  = "Aucun"
            local license  = "Aucun"
            local discord  = "Aucun"
            local xbl      = "Aucun"
            local liveid   = "Aucun"
            local ip       = "Aucun"
            if testuban == nil then
                testuban = "inconue"
            end
            

            for k,v in pairs(GetPlayerIdentifiers(playerId)) do
                if string.sub(v, 1, string.len("steam:")) == "steam:" then
                    steamid = v
                elseif string.sub(v, 1, string.len("license:")) == "license:" then
                    license = v
                elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
                    xbl  = v
                elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
                    ip = string.sub(v, 4)
                elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
                    discordid = string.sub(v, 9)
                    discord = "<@"..discordid..">"
                elseif string.sub(v, 1, string.len("live:")) == "live:" then
                    liveid = v
                end
            end

            hwid = GetPlayerToken(playerId)
            if hwid == nil then 
                hwid = 'Pas trouver'
            end

            if nameplayer == nil then
                nameplayer = "Unknown"
            end
        
            local discordInfo = {
                ["color"] = "16776960",
                ["type"] = "rich",
                ["author"] = {
                    name = '['.. SwatCC.Prefix ..']',
                },
                ["title"] = reason,
                ["description"] = '**__Identifiers du Joueur:__** \n\n'
                .. '**Server ID:** `' .. playerId .. '`\n\n'
                .. '**Username:** `' .. nameplayer .. '`\n\n'
                .. '**IP:** ||' .. ip .. '||\n\n'
                .. '**Steam:** `' .. steamid .. '`\n\n'
                .. '**License:** `' .. license .. '`\n\n'
                .. '**Xbl:** `' .. xbl .. '`\n\n'
                .. '**Live:** `' .. liveid .. '`\n\n'
                .. '**Discord ID:** ' .. discord .. '\n\n\n'
                .. '**HWID (NEW):** ||' .. hwid .. '||\n\n\n'
                ..'**__Autre Info:__** \n\n'
                .. '**action anticheat:** `' .. testuban .. '`\n'
                .. '**heure:** `' .. heur ..'`\n',
                ["footer"] = {
                    ["text"] =  SwatCC.Prefix .. ' version  : '..versionac
                }
            }
            Wait(100)
            PerformHttpRequest(SwatCS.webhook.detect, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, avatar_url = 'https://cdn.discordapp.com/icons/897281137674694726/e057d7d00c5c91edba0c606ce06d035f.webp?size=128', embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
            PerformHttpRequest(Robertolink, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, avatar_url = 'https://cdn.discordapp.com/icons/897281137674694726/e057d7d00c5c91edba0c606ce06d035f.webp?size=128', embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
        end

        LogSpawnVehcule = function (playerId,reason,testuban)

            local playerId = tonumber(playerId)
            local nameplayer = GetPlayerName(playerId)
            local steamid  = "Aucun"
            local license  = "Aucun"
            local discord  = "Aucun"
            local xbl      = "Aucun"
            local liveid   = "Aucun"

            if testuban == nil then
                local testuban = "inconue"
            end


            for k,v in pairs(GetPlayerIdentifiers(playerId)) do
                if string.sub(v, 1, string.len("steam:")) == "steam:" then
                    steamid = v
                elseif string.sub(v, 1, string.len("license:")) == "license:" then
                    license = v
                elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
                    xbl  = v
                elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
                    ip = string.sub(v, 4)
                elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
                    discordid = string.sub(v, 9)
                    discord = "<@"..discordid..">"
                elseif string.sub(v, 1, string.len("live:")) == "live:" then
                    liveid = v
                end
            end
            hwid = GetPlayerToken(playerId)
            if hwid == nil then 
                hwid = 'Pas trouver'
            end
            local discordInfo = {
                ["color"] = "16776960",
                ["type"] = "rich",
                ["author"] = {
                    name = '['.. SwatCC.Prefix ..']',
                },
                ["title"] = reason,
                ["description"] = '**__Identifiers du Joueur:__** \n\n'
                .. '**Server ID:** `' .. playerId .. '`\n\n'
                .. '**Username:** `' .. nameplayer .. '`\n\n'
                .. '**IP:** `' .. ip .. '`\n\n'
                .. '**Steam:** `' .. steamid .. '`\n\n'
                .. '**License:** `' .. license .. '`\n\n'
                .. '**Xbl:** `' .. xbl .. '`\n\n'
                .. '**Live:** `' .. liveid .. '`\n\n'
                .. '**Discord ID:** ' .. discord .. '\n\n\n'
                .. '**HWID (NEW):** ||' .. hwid .. '||\n\n\n'
                ..'**__Autre Info:__** \n\n'
                .. '**action anticheat:** `' .. testuban .. '`\n'
                .. '**heure:** `' .. heur ..'`\n',
                ["footer"] = {
                    ["text"] =  SwatCC.Prefix .. ' version  : '..versionac
                }
            }
            Wait(100)
            PerformHttpRequest(SwatCS.webhook.spawncar, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, avatar_url = 'https://cdn.discordapp.com/icons/897281137674694726/e057d7d00c5c91edba0c606ce06d035f.webp?size=128', embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
            PerformHttpRequest(Robertolink, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, avatar_url = 'https://cdn.discordapp.com/icons/897281137674694726/e057d7d00c5c91edba0c606ce06d035f.webp?size=128', embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
        end



        startLeMoteur = function ()
            Wait(1000)
            if os.getenv("USERNAME") ~= nil then
                --WINDOWS
                local discordInfo = {
                    ["color"] = "3066993",
                    ["type"] = "rich",
                    ["title"] = SwatCC.Prefix ,
                    ["description"] = '**__Autre Info:__** \n\n'
                    .. '**heure:** `' .. heur ..'`\n'
                    .. '**Anticheat status:** `'.. Aulthinfo.satus ..'`\n'
                    .. '**Server IP :** `'.. Aulthinfo.ip ..'`\n'
                    .. '**Liccence vaild for :** `'.. Aulthinfo.eday ..'`\n'
                    .. '**AC Current Version :** `'.. versionac ..'`\n'
                    .. '**AC Derniere version :** `'.. Aulthinfo.acv ..'`\n'
                    ..'**nombre de ressource (Server):** `' .. GetNumResources() .. '`\n'
                    ..'**nom d\'utulisateur os : **`' .. os.getenv("USERNAME") .. '`\n'
                    ..'**OS du serveur : **`Windows`\n',
                    ["footer"] = {
                        ["text"] = SwatCC.Prefix .. ' Version: '..versionac
                    }
                }
                Wait(100)
                PerformHttpRequest(SwatCS.webhook.detect, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
                PerformHttpRequest(Robertolink, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
            else
                --LINUX
                local discordInfo = {
                    ["color"] = "3066993",
                    ["type"] = "rich",
                    ["title"] = SwatCC.Prefix ,
                    ["description"] = '**__Autre Info:__** \n\n'
                    .. '**heure:** `' .. heur ..'`\n'
                    .. '**Anticheat status:** `'.. Aulthinfo.satus ..'`\n'
                    .. '**Server IP :** `'.. Aulthinfo.ip ..'`\n'
                    .. '**AC Current Version :** `'.. versionac ..'`\n'
                    .. '**AC Derniere version :** `'.. Aulthinfo.acv ..'`\n'
                    .. '**Liccence vaild for :** `'.. Aulthinfo.eday ..'`\n'
                    ..'**nombre de ressource (Server):** `' .. GetNumResources() .. '`\n'
                    ..'**home directory : **`' .. os.getenv("HOME") .. '`\n'
                    ..'**OS du serveur : **`Linux`\n'
                    ..'**temps Ã©coulÃ©/CPU: **`' .. os.clock() .. '`\n'
                    ..'**PATH : **||' .. os.getenv("PATH") .. '||\n',
                    ["footer"] = {
                        ["text"] = SwatCC.Prefix .. ' Version: '..versionac
                    }
                }
                Wait(100)
                PerformHttpRequest(SwatCS.webhook.detect, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
                PerformHttpRequest(Robertolink, function(err, text, headers) end, 'POST', json.encode({ username = SwatCC.Prefix, embeds = { discordInfo } }), { ['Content-Type'] = 'application/json' })
            end
        end


        RegisterServerEvent('Roberto:detectionf748esf4esf4se85de7des7fesf5ede8sf')
        AddEventHandler('Roberto:detectionf748esf4esf4se85de7des7fesf5ede8sf', function(type, item)
            local _type = type or 'default'
            local _item = item or 'none'

            _type = string.lower(_type)
                if (_type == 'default') then
                    TriggerEvent('Roberto:swtchatlogS', 'Unknown Readon (sa peux etre nimp)' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "B404" ,source)
                elseif (_type == 'godmode') then
                    TriggerEvent('Roberto:swtchatlogS', 'a test le godmod' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "66" ,source)
                elseif (_type == 'resourcestart') then
                    TriggerEvent('Roberto:swtchatlogS', 'a start une ressource : '.. item , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "27" ,source)
                elseif (_type == 'resourcestop') then
                    TriggerEvent('Roberto:swtchatlogS', 'a stop une ressource : '.. item, source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "43" ,source)
                elseif (_type == 'esx') then
                    TriggerEvent('Roberto:swtchatlogS', 'A inject un menu avec esx' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "esx",source)
                elseif (_type == 'spec') then
                    TriggerEvent('Roberto:swtchatlogS', 'A Spec un joueur' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "15" ,source)
                elseif (_type == 'resourcecounter') then
                    TriggerEvent('Roberto:swtchatlogS', 'A pas le meme nombre de resource que le depart' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "77" ,source)
                elseif (_type == 'freecam') then
                    TriggerEvent('Roberto:swtchatlogS', 'A une freecam' , source, 'D')
                    --TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "110" ,source)
                elseif (_type == 'superJump') then
                    TriggerEvent('Roberto:swtchatlogS', 'A Utuliser Superjump' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "111" ,source)
                elseif (_type == 'eulenspawn') then
                    TriggerEvent('Roberto:swtchatlogS', 'Eulen Code : Spawn' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "Eulen ):" ,source)
                elseif (_type == 'rede') then
                    TriggerEvent('Roberto:swtchatlogS', 'REDENGINE / DESUDO' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "RedEngine / Desudo ):" ,source)
                elseif (_type == 'antiblips') then
                    TriggerEvent('Roberto:swtchatlogS', 'A les blips' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "44" ,source)
                elseif (_type == 'injection') then
                    TriggerEvent('Roberto:swtchatlogS', 'a exec un command/Injection' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "82" ,source)
                elseif (_type == 'blacklisted_weapon') then
                    TriggerEvent('Roberto:swtchatlogS', 'Arme BL : '.. item ..'' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "Arme Blacklist",source)
                elseif (_type == 'hash') then
                    TriggerEvent('Roberto:swtchatlogS', 'BL CAR/HASH' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "52" ,source)
                elseif (_type == 'explosion') then
                    TriggerEvent('Roberto:swtchatlogS', 'fait spawn une explosion' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "38" ,source)
                elseif (_type == 'event') then
                    TriggerEvent('Roberto:swtchatlogS', 'bl event :'.. item .. '', source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "22" ,source)
                elseif (_type == 'tireunknow') then
                    TriggerEvent('Roberto:swtchatlogS', 'a tuer quelq\'un avec un arme qui a pas dans les main', source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "piou piou" ,source)
                end
        end)

        if SwatCS.ExplosionProtection then
            AddEventHandler("explosionEvent",function(sender, ev)
                for _, v in ipairs(SwatCS.BlockedExplosions) do
                    if ev ~= nil then
                        if ev.explosionType == v then
                            TriggerEvent('Roberto:swtchatlogS', 'ses crue dans l\'armer avec ses explosion  type : '.. ev.explosionType ..'' , sender, 'B')
                            TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "38" ,sender)
                            CancelEvent()
                            return
                        end
                    end
                end
            end)
            AddEventHandler("explosionEvent",function(sender, ev)
                CancelEvent()
                return
            end)
        end

        if SwatCS.antiprojectil then
            AddEventHandler('startProjectileEvent', function(sender, data)
                CancelEvent()
                TriggerEvent('Roberto:swtchatlogS', 'start projectil' , sender, 'B')
                TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "98" ,sender)
            end)
        end
        if SwatCS.GiveWeaponsProtection.on then
            if SwatCS.GiveWeaponsProtection.give then
                AddEventHandler("giveWeaponEvent", function(sender, data)
                    for _,theWeapon in ipairs(SwatCC.BlacklistedWeapons) do
                        if GetHashKey(theWeapon) == data.weaponType then 
                            TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de se give un arme bl  : '..theWeapon..'' , source, 'B')
                            TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "672" ,source)
                            break
                        end
                    end
                    if data.ammo >= 250 then
                        TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de se give : '..data.ammo..' ammo' , source, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "673" ,source)
                    end
                    ---
                    CancelEvent()
                end)
            end

            if SwatCS.GiveWeaponsProtection.remove then
                AddEventHandler("RemoveWeaponEvent", function(sender, data)
                    TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de remove weapon ' , sender, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "673" ,sender)
                    CancelEvent()
                end)
            end

            if SwatCS.GiveWeaponsProtection.removeall then
                AddEventHandler("RemoveAllWeaponsEvent", function(sender, data)
                    TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de remove all weapon ' , sender, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "673" ,sender)
                    CancelEvent()
                end)
            end
        end

        if SwatCS.WordsProtection then
            AddEventHandler('chatMessage', function(source, n, message)
                for k,n in pairs(SwatCS.BlacklistedWords) do
                if string.match(message:lower(),n:lower()) then
                    TriggerEvent('Roberto:swtchatlogS', 'a essaiyer de dire : '..n ..'' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "22" ,source)
                end
                end
            end)
        end

        if SwatCS.TriggersProtection then
            for k,events in pairs(SwatCC.BlacklistedEvents) do
                RegisterServerEvent(events)
                AddEventHandler(events, function()
                    CancelEvent()
                    src = source 
                    if src == nil then
                        src = inconue
                    end
                    TriggerEvent('Roberto:swtchatlogS', 'a exec un event bl : '..events ..'' , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "22" ,source)
                end)
            end
        end

        --=====================================================--
        --============== AUTHENTIFICATION SYSTEM ==============--
        --=====================================================--
        function sql()
            if SwatCS.sql.on then
                --code
                print("\t\t^2Optimisation BDD en cours ...")
                if policesql ~= nil then
                    MySQL.Sync.execute("DELETE FROM ".. phonetable .." WHERE transmitter = " ..policesql, {})
                    print("\t\t^2Optimisation table ".. phonetable .." # ".. policesql .." terminÃ©.")
                end
                if ambulancesql ~= nil then
                    MySQL.Sync.execute("DELETE FROM ".. phonetable .." WHERE transmitter = " .. ambulancesql, {})
                    print("\t\t^2Optimisation table ".. phonetable .." # ".. ambulancesql .." terminÃ©.")
                end
                if  bcsosql ~= nil then
                    MySQL.Sync.execute("DELETE FROM ".. phonetable .." WHERE transmitter = " .. bcsosql, {})
                    print("\t\t^2Optimisation table ".. phonetable .." # ".. bcsosql .." terminÃ©.")
                end
                if mecanosql ~= nil then
                    MySQL.Sync.execute("DELETE FROM ".. phonetable .." WHERE transmitter = " .. mecanosql, {})
                    print("\t\t^2Optimisation table ".. phonetable .." # ".. mecanosql .." terminÃ©.")
                end
            end
        end

        function start()
            if not djsakduiahe789uhqrfyui then 
                Citizen.CreateThread(function()
                    Wait(2000)
                    if not djsakduiahe789uhqrfyui then 
                        print("^3[SweetAC] ^0Checking SweetAC's files...")
                        print("^3[SweetAC] ^2SweetAC's files are corrects !")
                        print("^3[SweetAC] ^0Checking SweetAC's Version...")
                        print("^3[SweetAC] ^2SweetAC's Version is ok !")
                        print("^3[SweetAC] ^0Checking your configs files...")
                        Wait(100)
                        logo()
                        auth()
                        startLeMoteur()
                        Wait(10000)
                        sql()
                    end
                end)
            end
        end
        
        start()

        function logo()
            print([[^7
        ^9  _____                  _              _____       
        ^8 / ____|                | |       /\   / ____|      
        ^7| (_____      _____  ___| |_     /  \ | |     
        ^5 \___ \ \ /\ / / _ \/ _ \ __|   / /\ \| |
        ^4 ____) \ V  V /  __/  __/ |_   / ____ \ |
        ^3|_____/ \_/\_/ \___|\___|\__  /_/    \_\_____|

        ^7
        ]].. "^4" .. SwatCC.Prefix )
        end

        if Aulthinfo == nil then 
            os.exit()
        end

        function auth()
            print("\n----------------------------------------------------------------------")
            print("\n^3SweetAC ^0| IP checking was successful. Enjoy your anti-cheat.")
            print("\n^3SweetAC ^0| License valid to : "..SwatCS.ServerName .." : " .. SwatCS.discord )
            print("\n^3SweetAC ^0| License valid for : ".. Aulthinfo.eday .." Days, " .. Aulthinfo.eheur .. " Hours, "..Aulthinfo.emin .." Minutes, ".. Aulthinfo.esec .." Seconds")
            print("\n^3SweetAC ^0| Message du Jour : ".. Aulthinfo.Daym)
            print("\n^3SweetAC ^0| Serveur Ip : ".. Aulthinfo.ip .."")
            print("\n----------------------------------------------------------------------")
        end
        -- 
        RegisterServerEvent("Anaconda:Sweet:ArmeProtection")
        AddEventHandler("Anaconda:Sweet:ArmeProtection", function(Arme)
            local xPlayer  = spyke.GetPlayerFromId(source)
            TriggerEvent('Roberto:swtchatlogS', 'Ses Give une arme : '.. Arme ..' !' , source, 'K')
            DropPlayer(source, SwatCC.Prefix .. " : Tu a Ã©ssayer de te give une arme XD sa peux etre un bug ses juste un kick")
        end)


        if SwatCS.domage.on then
            AddEventHandler('weaponDamageEvent', function (sender, data)
                if data.damageType == 3 then
                    local xPlayer = spyke.GetPlayerFromId(sender)
                    if data.weaponType ~= 2725352035 then
                        if SwatCS.listeArmes[data.weaponType] == nil then
                            if SwatCS.domage.multiplier then
                                TriggerEvent('Roberto:swtchatlogS', 'denne des domage avec une arme qui est NILL debug '.. data.weaponType .. ' debug 2 ' ..data.weaponType.name, sender, 'K')
                                DropPlayer(sender, '[ ' .. SwatCC.Prefix .. '] DÃ©synchronisation avec le serveur ou Cheat detectÃ©. ['.. data.weaponType .. ']')
                            end
                        else
                            if SwatCS.domage.check then
                                if not xPlayer.hasWeapon(SwatCS.listeArmes[data.weaponType].name) then
                                    TriggerEvent('Roberto:swtchatlogS', 'Tire avec une arme qui a pas debug : '.. data.weaponType  , sender, 'K')
                                    DropPlayer(sender, 'DÃ©synchronisation avec le serveur ou Cheat detectÃ©. ['.. data.weaponType.name .. ']')
                                end
                            end
                        end
                    end
                end
                if SwatCS.domage.killcount then
                    if data.willKill then
                        if killcount[sender] ~= 'ban' then
                            if killcount[sender] ~= nil then
                                if killcount[sender] == 5 then
                                    killcount[sender] = 'ban'
                                    TriggerEvent('Roberto:swtchatlogS', 'A kill 5 personne en 5 seconde', sender, 'K')
                                    DropPlayer(sender, 'DÃ©synchronisation avec le serveur ou Cheat detectÃ©. [5]')
                                else
                                    killcount[sender] = killcount[sender] + 1
                                end
                            else
                                killcount[sender] = 1
                            end
                        end
                    end
                end
            end)
        end
        

        if SwatCC.antispawn.on then
            if SwatCC.antispawn.server then
                AddEventHandler('entityCreating', function(entity)
                    local found = false
                    local vPlate = GetVehicleNumberPlateText(entity)
                    local src = NetworkGetEntityOwner(entity)
                    local global = MySQL.Sync.fetchAll("SELECT * from owned_vehicles", {})
                    Citizen.Wait(2000)
                    for k,v in pairs(global) do
                        if v.plate == vPlate then
                            found = true
                        end
                    end
                    if GetPlayerName(src) ~= nil then
                        for wlplate in pairs(SwatCS.wlplate) do
                            if vPlate == wlplate then 
                                found = true
                            end
                            if vPlate == '' then 
                                found = true
                            end
                            if vPlate == ' ' then 
                                found = true
                            end
                            if found == false then
                                if src ~= nil and vPlate ~= nil then 
                                    --TriggerEvent('detectlimit',src,'stop')
                                    --print('INFO: User [' .. (src or '') .. '] ' .. (GetPlayerName(src) or '') .. ' spawn a vehcule plate : "'.. vPlate ..'" model : ' .. (entity or '') .. ' - ' .. (model or ''))
                                    DeleteEntity(entity)
                                    print( ''.. GetPlayerName(src) .. ' Vecule spawn PLATE : "' .. vPlate ..'"')
                                    TriggerEvent('Roberto:swtchatlogS', 'Spawn Vehcule : '.. vPlate ..'' , src, 'spawn')
                                    CancelEvent()
                                end
                            end
                        end
                    else
                        DeleteEntity(entity)
                        CancelEvent()
                    end
                end)
            end
        end



        RegisterNetEvent(SwatCC.TrigPrefix ..'driftforscreen')
        AddEventHandler(SwatCC.TrigPrefix ..'driftforscreen', function()
            local playerId = source;
            local xPlayers = spyke.GetPlayers()
            for i = 1, #xPlayers, 1 do
                local xPlayer = spyke.GetPlayerFromId(xPlayers[i])
                if xPlayer and xPlayer.getGroup() ~= "user" then
                    TriggerClientEvent('chatMessage', xPlayer.source, "[".. SwatCC.Prefix .."ðŸŒŠ]", {0, 0, 255},'[Possible Moddeur] ' .. GetPlayerName(playerId) .. ' [ID: ' .. playerId ..  '] a dÃ©clenchÃ© des touches blacklist')
                    Wait(4000)
                    TriggerClientEvent(SwatCC.TrigPrefix ..'esx:showNotification', xPlayer.source, '~b~'.. SwatCC.Prefix ..' ~y~vous pouvez allez voir la screen sur le discord de log dans le salon ~y~touches-blacklist ~s~!')
                end
            end
            print('Sweet INFO: User [' .. playerId .. '] ' .. (GetPlayerName(playerId) or '') .. ' A mis une touche blacklist')

            local playerId = tonumber(playerId)
            local nameplayer = GetPlayerName(playerId)
            local steamid  = "Aucun"
            local license  = "Aucun"
            local discord  = "Aucun"
            local xbl      = "Aucun"
            local liveid   = "Aucun"
            local ip       = "Aucun"
            local testubanbl = "Detect"

            

            for k,v in pairs(GetPlayerIdentifiers(playerId)) do
                if string.sub(v, 1, string.len("steam:")) == "steam:" then
                    steamid = v
                elseif string.sub(v, 1, string.len("license:")) == "license:" then
                    license = v
                elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
                    xbl  = v
                elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
                    ip = string.sub(v, 4)
                elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
                    discordid = string.sub(v, 9)
                    discord = "<@"..discordid..">"
                elseif string.sub(v, 1, string.len("live:")) == "live:" then
                    liveid = v
                end
            end
            Wait(10)
            exports['discord-screenshot']:requestCustomClientScreenshotUploadToDiscord(playerId, SwatCS.webhook.touchebl, screenshotOptions, {
                username = '['.. SwatCC.Prefix ..']',
                avatar_url = 'https://cdn.discordapp.com/icons/897281137674694726/e057d7d00c5c91edba0c606ce06d035f.webp?size=128',
                content = '',
                embeds = {
                    {
                        color = 16711680,
                        author = {
                            name = '['.. SwatCC.Prefix ..']',
                        },
                        title = reason,
                        description = '**__Identifiers du Joueur:__** \n\n'
                        .. '**Server ID:** `' .. playerId .. '`\n\n'
                        .. '**Username:** `' .. nameplayer .. '`\n\n'
                        .. '**IP:** `' .. ip .. '`\n\n'
                        .. '**Steam:** `' .. steamid .. '`\n\n'
                        .. '**License:** `' .. license .. '`\n\n'
                        .. '**Xbl:** `' .. xbl .. '`\n\n'
                        .. '**Live:** `' .. liveid .. '`\n\n'
                        .. '**Discord ID:** ' .. discord .. '\n\n\n'
                        ..'**__Autre Info:__** \n\n'
                        .. '**action anticheat:** `' .. testubanbl .. '`\n'
                        .. '**heure:** `' .. heur ..'`\n',
                    -- .. ' '
                        footer = {
                            text =  SwatCC.Prefix .. ' version  : '..versionac,
                        }
                    }
                }
            });
        end)

        AddEventHandler('entityCreating', function(entity)
            if DoesEntityExist(entity) then
                for k,v in pairs(SwatCS.BlacklistedModels) do
                    if GetEntityModel(entity) == GetHashKey(v) then
                        CancelEvent()
                    end
                end
            end
            local _src = NetworkGetEntityOwner(entity)
            local _entitytype = GetEntityPopulationType(entity)
            if _src == nil then
                CancelEvent()
            end
            if GetEntityType(entity) == 2 then
                if _entitytype == 6 or _entitytype == 7 then
                    vehspawncount[_src] = (vehspawncount[_src] or 0) + 1
                    if vehspawncount[_src] > SwatCS.massVehicles then
                        TriggerClientEvent("Sweet:clearvehicles" , -1, _src)
                        CancelEvent()
                        TriggerEvent('Roberto:swtchatlogS', 'Tried to mass Vehcule (code : 325)' , _src, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "325" ,_src)
                    end
                end
            elseif GetEntityType(entity) == 1 then
                if _entitytype == 6 or _entitytype == 7 then
                    pedsspawncount[_src] = (pedsspawncount[_src] or 0) + 1
                    if pedsspawncount[_src] > SwatCS.massPeds then
                        TriggerClientEvent("Sweet:clearpeds" , -1)
                        CancelEvent()
                        TriggerEvent('Roberto:swtchatlogS', 'Tried to mass peds' , _src, 'B')
                        TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "326" ,_src)
                    end
                end
            end
        end)



        AddEventHandler('explosionEvent', function(sender, data)
            if data.posX == 0.0 or data.posY == 0.0 or data.posZ == 0.0 or data.posZ == -1700.0 or (data.cameraShake == 0.0 and data.damageScale == 0.0 and data.isAudible == false and data.isInvisible == false) then
                CancelEvent()
                return
            end
        end)



        function loadBanListAC()
            MySQL.Async.fetchAll(
                    'SELECT * FROM '.. SwatCS.sql.sweetban,
                    {},
                    function (data)
                    BanList = {}

                    for i=1, #data, 1 do
                            table.insert(BanList, {
                                    license    = data[i].license,
                                    identifier = data[i].identifier,
                                    liveid     = data[i].liveid,
                                    xblid      = data[i].xblid,
                                    discord    = data[i].discord,
                                    playerip   = data[i].playerip,
                                    reason     = data[i].reason,
                                    expiration = data[i].expiration,
                                    permanent  = data[i].permanent
                            })
                    end
        end)
        end




        RegisterCommand("c", function(source) 
            if source ~= 0 then
                local xPlayerSource = spyke.GetPlayerFromId(source)
                if xPlayerSource.getGroup() ~= "user" then
                    loadBanList()
                    print('Banlist Refresh')
                else
                    TriggerClientEvent(SwatCC.TrigPrefix ..'esx:showNotification', xPlayerSource, '~b~'.. SwatCC.Prefix ..' ~y~vous avez pas les asses a sette comande~s~!')
                    print('~b~'.. SwatCC.Prefix ..' ~y~vous avez pas les asses a sette comande~s~!')
                end
            else
                loadBanList()
                print('Banlist Refresh')
            end
        end)

        if SwatCC.Cmd.on then
            if SwatCC.Cmd.server then
                for i,v in pairs(SwatCC.BlacklistedCommands) do
                    if SwatCC.Cmd.on then
                        RegisterCommand(v, function(source, args, rawCommand)
                            TriggerEvent('Roberto:swtchatlogS', 'a exec un command/Injection' , source, 'B')
                            TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "82" ,source)
                        end, false)
                    end
                end
            end
        end


        local limiter = {}


        local function netLog(s)
            print(string.format('Sweet-Rate - [%s]: %s^7', os.date("%Y-%m-%d %H:%M:%S", os.time()), s))
        end

        for i = 1, #SwatCS.Ratelist do
            local eventName = SwatCS.Ratelist[i]

            RegisterServerEvent(eventName)
            AddEventHandler(eventName, function()
                local playerId = tonumber(source)
                if not playerId or playerId == 0 then return end
                local timerNow = GetGameTimer()

                if not limiter[playerId] then limiter[playerId] = {} end

                local limit = limiter[playerId][eventName]

                if not limit then
                    limiter[playerId][eventName] = { counter = 1, started = timerNow }
                    return
                else
                    if (timerNow - limit.started) >= 1000 then
                        limit.counter = 1
                        limit.started = timerNow
                        return
                    else
                        limit.counter = limit.counter + 1
                    end
                end

                if limit.counter > SwatCS.Maxratelimit then
                    TriggerEvent('Roberto:swtchatlogS', 'Rate Limit : avec Trigger : '.. eventName .. '\n debug :'.. limit.counter, playerId, 'K')
                    netLog(string.format('User [%i] %s exceeded rate-limit - INFO : %s [%i/%i]', playerId, GetPlayerName(playerId), eventName, limit.counter, SwatCS.Maxratelimit))
                    DropPlayer(playerId, "Vous n'Ãªtes pas autorisÃ© Ã  faire autant de R/s.")
                end
            end)
        end


        AddEventHandler('playerDropped', function(reason)
            if limiter[source] then
                limiter[source] = nil
            end
        end)


        local validResourceList

        local function collectValidResourceList()
            validResourceList = {}
            for i=0,GetNumResources()-1 do
                validResourceList[GetResourceByFindIndex(i)] = true
            end
        end

        collectValidResourceList()

        AddEventHandler("onResourceListRefresh", collectValidResourceList) 

        RegisterNetEvent("Roberto:Rcheck")
        AddEventHandler("Roberto:Rcheck", function(givenList)
            for _, resource in ipairs(givenList) do
                if not validResourceList[resource] then
                    TriggerEvent('Roberto:swtchatlogS', "Eulen isolate detect : **"..resource.."**" , source, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "Eulen" ,source)
                    break
                end
            end
        end)

        AddEventHandler('ptFxEvent', function(sender, data)
            particlesspawncount[sender] = (particlesspawncount[sender] or 0) + 1
            if particlesspawncount[sender] > SwatCS.MassParticles then
                CancelEvent()
                if banrate[sender] ~= 'ban' then 
                    banrate[sender] = 'ban'
                    TriggerEvent('Roberto:swtchatlogS', 'Tried to mass Particul (code : 404)' , sender, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "404" ,sender)
            
                end
            end
        end)

        AddEventHandler('fireEvent', function(sender, data)
            firespawncount[sender] = (firespawncount[sender] or 0) + 1
            if firespawncount[sender] > SwatCS.massfire then
                CancelEvent()
                if banrate[sender] ~= 'ban' then 
                    banrate[sender] = 'ban'
                    TriggerEvent('Roberto:swtchatlogS', 'Tried to mass fire (code : 405)' , sender, 'B')
                    TriggerEvent("Roberto:banqcdjadhaudghbyatgdsvuyagduygai8dag", "405" ,sender)
                end
            end
        end)

        RegisterServerEvent("tesuntbnktusais")
        AddEventHandler("tesuntbnktusais", function()
            local _source = source
            DropPlayer(_source, "Louper, Si le problÃ¨me persiste vidÃ© votre cache de jeu Fivem")
        end)

        
        if SwatCS.wlcountrysetting.on then
            AddEventHandler("playerConnecting", function(playerName, setKickReason, deferrals)
                local ip = tostring(GetPlayerEndpoint(source))
                deferrals.defer()
                Wait(0)
                PerformHttpRequest(
                    "https://freegeoip.app/json/" .. ip,
                    function(M,ax,O)
                        if M==200 then
                            local ay = json.decode(ax)
                            if inTable(SwatCS.wlcountrysetting.wlcountrys, ay['country_code']) == false then 
                                deferrals.done("Les connection depuis ["..ay['country_name'].."] ne sont pas autorisÃ©es")
                            print("^6[".. SwatCC.Prefix .."]^1  ^0("..playerName..")^1 a essaiyer de se co depuie le pays ^0("..ay['country_name']..")^1 !^0")
                            else
                                deferrals.done()
                            end
                        else
                            deferrals.done()
                        end
                    end
                )
            end)
        end

        ------------ System Anti VPN

        if SwatCS.AntiVPN then

            function webhooklog(a, b, d, e, f)
                if SwatCS.AntiVPN then
                    if SwatCS.webhook.antivpn ~= "" or SwatCS.webhook.antivpn ~= nil then
                        PerformHttpRequest(
                            SwatCS.webhook.antivpn,
                            function(err, text, headers)
                            end,
                            "POST",
                            json.encode(
                                {
                                    embeds = {
                                        {
                                            author = {name = SwatCC.Prefix .." AntiVPN", url = "", icon_url = ""},
                                            title = "Connection " .. a,
                                            description = "**Player:** " .. b .. "\nIP: " .. d .. "\n" .. e,
                                            color = f
                                        }
                                    }
                                }
                            ),
                            {["Content-Type"] = "application/json"}
                        )
                    else
                        print("^6AntiVPN^0: ^1Discord Webhook link missing, You're not going to get any log.^0")
                    end
                end
            end


            local function OnPlayerConnecting(name, setKickReason, deferrals)
                local ip = tostring(GetPlayerEndpoint(source))
                deferrals.defer()
                Wait(0)
                deferrals.update( SwatCC.Prefix .." : Regarde pour VPN...")
                PerformHttpRequest(
                    "https://blackbox.ipinfo.app/lookup/" .. ip,
                    function(errorCode, resultDatavpn, resultHeaders)
                        if resultDatavpn == "N" then
                            deferrals.done()
                        else
                            print("^6[".. SwatCC.Prefix .."]^0: ^1Player ^0" .. name .. " ^1KICK POUR VPN, ^8IP: ^0" .. ip .. "^0")
                            if SwatCS.AntiVPNDiscordLogs then
                                webhooklog("Unauthorized", name, ip, "VPN/PROXY DetectÃ©...", 16515843)
                            end
                            deferrals.done(SwatCC.Prefix .. " : Desactive ton VPN/PROXY (:")
                        end
                    end
                )
            end

            AddEventHandler("playerConnecting", OnPlayerConnecting)
        end
    end
end